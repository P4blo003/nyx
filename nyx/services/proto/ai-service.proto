syntax = "proto3";

// ==========================================================================================
// Author: Pablo González García.
// Created: 02/02/2026
// Last edited: 02/02/2026
// ==========================================================================================


// ==============================
// DEFAULT
// ==============================

package ai_service.v1;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";


// ==============================
// SERVICES
// ==============================

service AIService
{
    // ---- Models ---- //

    // List installed models.
    rpc list_models(ListModelsRequest) returns (ListModelsResponse);
    // Load a model in Triton.
    rpc load_model(LoadModelRequest) returns (ModelStatus);
    // Unload a model from Triton.
    rpc unload_model(UnloadModelRequest) returns (ModelStatus);


    // ---- Inference ---- //

    // Make normal inference.
    rpc make_infer(InferenceRequest) returns (InferenceResponse);
    // Make streamed inference.
    rpc make_infer_stream(InferenceRequest) returns (stream InferenceResponse);
}


// ==============================
// MESSAGES
// ==============================

message LoadModelRequest
{
    string name = 1;
    string version = 2;
    string server = 3;
}

message UnloadModelRequest
{
    string name = 1;
    string version = 2;
    string server = 3;
}

message ModelStatus
{
    string name = 1;
    string version = 2;
    string server = 3;

    enum State
    {
        UNKNOWN = 0;
        LOADING = 1;
        READY = 2;
        UNLOADED = 3;
        ERROR = 4;
    }
    State state = 4;
    string message = 5;
}

message ListModelsRequest
{
    // Optional.
    string filter = 1;
}

message ListModelsResponse
{
    repeated ModelMetadata models = 1;
}

message ModelMetadata
{
    string name = 1;
    string version = 2;
    string server = 3;
}

message InferenceRequest
{
    string task = 1;

    oneof batch
    {
        TextBatch text_batch = 2;
        ImageBatch image_batch = 3;
    }
}

message TextBatch
{
    repeated string content = 1;
}

message ImageBatch
{
    repeated bytes content = 1;
}

message InferenceResponse
{
    string task = 1;

    oneof result
    {
        TextBatch text_batch = 2;
        EmbeddingBatch embedding_batch = 3;   
    }
}

message EmbeddingBatch  
{
    repeated EmbeddingVector vectors = 1;
}

message EmbeddingVector
{
    repeated float values = 1;
}